<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Tibor Pilz">
  <title>CSS Houdini</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/reset.css">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/theme/black.css" id="theme">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//plugin/highlight/zenburn.css">
  <link rel="stylesheet" href="css/avenga.css"/>
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">CSS Houdini</h1>
  <p class="author">Tibor Pilz</p>
  <p class="date">05.10.2020</p>
</section>

<section class="slide level1">

<style>
    h1 {
        font-size: 64px !important;
    }
    h2 {
        font-size: 48px !important;
    }
    p {
        font-size: 24px !important;
    }
    li {
        line-height: 0.9 !important;
        margin-top: 0.5em !important;
    }
</style>
</section>
<section id="css-houdini-is" class="slide level1">
<h1>CSS Houdini is:</h1>
<ul>
<li class="fragment">A collection of low-level APIs which expose parts
of the CSS engine</li>
<li class="fragment">Not production-ready - and might never be</li>
</ul>
</section>
<section id="components" class="slide level1">
<h1>Components</h1>
<ol type="1">
<li class="fragment">CSS Parser API</li>
<li class="fragment">CSS Typed OM</li>
<li class="fragment">CSS Properties and Values API</li>
<li class="fragment">CSS Painting API</li>
<li class="fragment">Worklets</li>
<li class="fragment">CSS Layout API</li>
<li class="fragment">CSS Animation API</li>
</ol>
</section>
<section id="state-of-css-houdini" class="slide level1">
<h1>State of CSS Houdini</h1>
<iframe src="https://ishoudinireadyyet.com" style="background: white; width: 1200px; height: 50vh; margin-top: 0px">
</iframe>
</section>
<section id="the-css-typed-object-model" class="slide level1">
<h1>The CSS Typed Object Model</h1>
<ul>
<li class="fragment">CSS has an object model (CSSOM)</li>
<li class="fragment">Access is done via the <code>style</code>
attribute</li>
</ul>
<pre ><code class="js">const el = document.getElementById('test-element');
el.style.opacity = 0.3;
el.style.fontSize = '24px';</code></pre>
</section>
<section id="problems-with-cssom" class="slide level1">
<h1>Problems with CSSOM</h1>
<pre ><code class="js">console.log(typeof el.style.opacity); // 'string'
el.style.opacity += 0.1;
console.log(el.style.opacity); // '0.30.1' - wat</code></pre>
<ul>
<li class="fragment">These attributes are <em>always</em> strings.</li>
</ul>
</section>
<section id="problems-with-cssom-1" class="slide level1">
<h1>Problems with CSSOM</h1>
<aside class="notes">
<p>Furthermore, working with CSS units such as ‘px’ is cumbersome. This
example shows that even when converting back, the ‘px’ suffix must be
strictly considered.</p>
</aside>
<pre ><code class="js">const { fontSize, opacity } = footer.style;
const parsedFontSize = parseFloat(fontSize);

el.style.fontSize = `${parsedFontSize + 5}px`;

const parsedOpacity = parseFloat(opacity);
el.style.opacity = parsedOpacity + 0.1;</code></pre>
<ul>
<li class="fragment">Working with unit values is laborious, as it
requires constant parsing or serialization of strings.</li>
</ul>
</section>
<section id="css-typed-om---attributestylemap" class="slide level1">
<h1>CSS Typed OM - attributeStyleMap</h1>
<aside class="notes">
<p>Styles can be set and retrieved using
<code>attributeStyleMap.set</code> and <code>.get</code>.</p>
</aside>
<pre ><code class="js">el.attributeStyleMap.get('opacity').value; // 0.5
el.attributeStyleMap.get('fontSize').value; // 29
el.attributeStyleMap.get('fontSize').unit; // 'px'</code></pre>
<ul>
<li class="fragment"><code>el.attributeStyleMap.get</code> returns a
<code>CSSUnitValue</code> with a <code>value</code> and a
<code>unit</code>.</li>
</ul>
</section>
<section id="setting-css-typed-om-values" class="slide level1">
<h1>Setting CSS Typed OM Values</h1>
<aside class="notes">
<p>It’s advisable to pass a <code>CSSUnitValue</code> to
<code>el.attributeStyleMap.set</code>. An explanation of
<code>CSSUnitValue</code> follows.</p>
</aside>
<pre ><code class="js">footer.attributeStyleMap.set('fontSize', CSS.px(29));
footer.attributeStyleMap.set('fontSize', '29px'); // Just as valid</code></pre>
</section>
<section id="css-style-values" class="slide level1">
<h1>CSS Style Values</h1>
<ul>
<li class="fragment">Numbers are represented in two ways:
<ol type="1">
<li class="fragment"><code>CSSUnitValue</code>: corresponds to, e.g.,
“42px”</li>
<li class="fragment"><code>CSSMathValue</code>: corresponds to, e.g.,
“calc(56em + 10%)”</li>
</ol></li>
</ul>
</section>
<section id="css-unit-values" class="slide level1">
<h1>CSS Unit Values</h1>
<ul>
<li class="fragment">To create <code>CSSUnitValue</code>s, these factory
methods exist (among others):</li>
</ul>
<pre ><code class="js">const { value, unit } = CSS.number('10');
// value === 10, unit === 'number'

const { value, unit } = CSS.px(42);
// value === 42, unit === 'px'

const { value, unit } = CSS.vw('100');
// value === 100, unit === 'vw'

const { value, unit } = CSS.percent('10');
// value === 10, unit === 'percent'</code></pre>
</section>
<section id="cssunitvalues---alternative" class="slide level1">
<h1>CSSUnitValues - Alternative:</h1>
<ul>
<li class="fragment">Alternatively, the constructor can be called
directly</li>
</ul>
<pre ><code class="js">const { value, unit } = new CSSUnitValue(10, 'number');
// value === 10, unit === 'number'

const { value, unit } = new CSSUnitValue(42, 'px');
// value === 10, unit === 'number'

const { value, unit } = new CSSVWValue('100');
// value === 100, unit === 'vw'

const { value, unit } = new CSSPercentValue('10');
// value === 10, unit === 'percent'</code></pre>
</section>
<section id="cssmathvalues" class="slide level1">
<h1>CSSMathValues</h1>
<pre ><code class="js">const cssSum = new CSSMathSum(CSS.vw(100), CSS.px(-10));

cssSum.toString(); // "calc(100vw + -10px)"</code></pre>
<ul>
<li class="fragment">Similar classes exist for other CSS calc
expressions, like <code>CSSMathNegate</code>,
<code>CSSMathInvert</code>, <code>CSSMathProduct</code>, etc.</li>
</ul>
</section>
<section id="cssmathvalues---nested" class="slide level1">
<h1>CSSMathValues - Nested</h1>
<pre ><code class="js">const calculation = new CSSMathSum(
  CSS.px(1),
  new CSSMathNegate(
    new CSSMathProduct(2, CSS.em(3))
  )
);

calculation.toString(); // "calc(1px - 2 * 3em)"</code></pre>
<ul>
<li class="fragment">Calculations with multiple operators can be
expressed using nested constructors.</li>
</ul>
</section>
<section id="cssstylevalues---beyond" class="slide level1">
<h1>CSSStyleValues - Beyond</h1>
<ul>
<li class="fragment">CSSStyleValues support additional features:</li>
</ul>
</section>
<section id="css-calc-shorthand" class="slide level1">
<h1>CSS calc shorthand</h1>
<aside class="notes">
<p>Instead of using a <code>CSSMathAdd</code> constructor, function
calls can be chained. Notably, arithmetic on two similar units
automatically returns the result in that unit, while arithmetic on two
different units returns an instance of <code>CSSMathValue</code>.</p>
</aside>
<pre ><code class="js">CSS.px(1).add(CSS.px(2)); // { value: 3, unit: 'px' }
CSS.px(1).add(CSS.vw(50)).toString(); // "calc(1px + 50vw)"</code></pre>
</section>
<section id="unit-conversion" class="slide level1">
<h1>Unit Conversion</h1>
<pre ><code class="js">CSS.px(1).to('mm'); // { value: 0.26444, unit: "mm" }</code></pre>
</section>
<section id="equality-comparison" class="slide level1">
<h1>Equality Comparison</h1>
<pre ><code class="js">const width = CSS.px(200);
CSS.px(200).equals(width); // true</code></pre>
</section>
<section id="property-and-values-api" class="slide level1">
<h1>Property and Values API</h1>
<ul>
<li class="fragment">Basically CSS custom properties…</li>
<li class="fragment">…but with types!</li>
<li class="fragment">enables:
<ul>
<li class="fragment">typing</li>
<li class="fragment">inheritance</li>
<li class="fragment">initial values</li>
<li class="fragment">animations ✨</li>
</ul></li>
</ul>
</section>
<section id="example" class="slide level1">
<h1>Example</h1>
<pre ><code class="css">  .box {
    --color-top: turquoise;
    --color-bottom: orange;
    
    width: 250px;
    height: 250px;
    
    background: linear-gradient(var(--color-top), var(--color-bottom));
    
    transition: 1s;
    transition-property: --color-top, --color-bottom;
  }

  .box:hover {
    --color-top: orange;
    --color-bottom: turquoise;
  }</code></pre>
<ul>
<li class="fragment">CSS custom values can’t be animated</li>
</ul>
</section>
<section id="example---first-try" class="slide level1">
<h1>Example - First Try</h1>
<iframe style="width: 512px; height: 512px" src="https://AnimatedGradients-1--tbrpilz.repl.co">
</iframe>
</section>
<section id="example---extension" class="slide level1">
<h1>Example - Extension</h1>
<pre ><code class="js">CSS.registerProperty({
  name: '--color-top',
  syntax: '&lt;color&gt;',
  inherits: false,
  initialValue: '#c0ffee',
});

CSS.registerProperty({
  name: '--color-bottom',
  syntax: '&lt;color&gt;',
  inherits: false,
  initialValue: '#c0ffee',
})</code></pre>
</section>
<section id="example---second-try" class="slide level1">
<h1>Example - Second Try</h1>
<iframe style="width: 512px; height: 512px" src="https://AnimatedGradients--tbrpilz.repl.co">
</iframe>
</section>
<section id="css-painting-api" class="slide level1">
<h1>CSS Painting API</h1>
<ul>
<li class="fragment">Enables custom implementation of the
<code>paint()</code> CSS-function</li>
<li class="fragment">Uses <code>PaintWorklets</code>, which receive a
<code>ctx</code></li>
<li class="fragment">Really similar to working with a canvas</li>
</ul>
</section>
<section id="paint-worklet" class="slide level1">
<h1>Paint Worklet</h1>
<p>A worklet according to the CSS Houdini spec</p>
<p><code>main.js</code></p>
<pre ><code class="js">CSS.paintWorklet.addModule('my-paint-worklet.js')</code></pre>
<p><code>my-paint-worklet.js</code></p>
<pre ><code class="js">class MyPainter {
  paint(ctx, geometry, properties) {
    // go Pollock
  }
}

registerPaint('myPainter', MyPainter)</code></pre>
<p><code>main.css</code></p>
<pre ><code class="css">.box {
  background-image: paint('myPainter')
}</code></pre>
</section>
<section id="example-1" class="slide level1">
<h1>Example</h1>
<iframe src="/example" style="background: white; width: 1200px; height: 50vh; margin-top: 0px">
</iframe>
</section>
<section id="references" class="slide level1">
<h1>References</h1>
</section>
    </div>
  </div>

  <script src="https://unpkg.com/reveal.js@^4//dist/reveal.js"></script>

  // reveal.js plugins
  <script src="https://unpkg.com/reveal.js@^4//plugin/notes/notes.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/search/search.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/zoom/zoom.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/highlight/highlight.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: true,
        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,
        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: "bottom-right",
        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: "faded",
        // Display a presentation progress bar
        progress: true,
        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,
        // Push each slide change to the browser history
        history: true,
        // Enable keyboard shortcuts for navigation
        keyboard: true,
        // Enable the slide overview mode
        overview: true,
        // Vertical centering of slides
        center: false,
        // Enables touch navigation on devices with touch input
        touch: true,
        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',
        // Turns fragments on and off globally
        fragments: true,
        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: true,
        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,
        // Global override for autoplaying embedded media (video/audio/iframe)
        // - null: Media will only autoplay if data-autoplay is present
        // - true: All media will autoplay, regardless of individual setting
        // - false: No media will autoplay, regardless of individual setting
        autoPlayMedia: null,
        // Global override for preloading lazy-loaded iframes
        // - null: Iframes with data-src AND data-preload will be loaded when within
        //   the viewDistance, iframes with only data-src will be loaded when visible
        // - true: All iframes with data-src will be loaded when within the viewDistance
        // - false: All iframes with data-src will be loaded only when visible
        preloadIframes: null,
        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,
        // Stop auto-sliding after user input
        autoSlideStoppable: true,
        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,
        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,
        // Hide cursor if inactive
        hideInactiveCursor: true,
        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,
        // Transition style
        transition: 'fade', // none/fade/slide/convex/concave/zoom
        // Transition speed
        transitionSpeed: 'default', // default/fast/slow
        // Transition style for full page slide backgrounds
        backgroundTransition: 'fade', // none/fade/slide/convex/concave/zoom
        // Number of slides away from the current that are visible
        viewDistance: 3,
        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,
        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,
        // The display mode that will be used to show slides
        display: 'block',

        // reveal.js plugins
        plugins: [
          RevealHighlight,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    </body>
</html>
